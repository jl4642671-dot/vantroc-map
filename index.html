<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VanTroc Map - Carte des Annonces</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        body{margin:0;padding:0;}
        #map{width:100%;height:100vh;}
        .popup-content h3 {margin:0 0 10px 0;color:#667eea;}
        .popup-content p {margin:5px 0;}
        .popup-content .price {font-size:18px;font-weight:bold;color:#764ba2;}
    </style>
</head>
<body>
        <nav style="background: white; padding: 1rem 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <h1 style="color: #667eea; font-size: 1.8rem; margin: 0;">üöê VanTroc</h1>
        <div style="display: flex; gap: 2rem;">
            <a href="home.html" style="color: #333; text-decoration: none; font-weight: 500; transition: color 0.3s;">Accueil</a>
            <a href="index.html" style="color: #333; text-decoration: none; font-weight: 500; transition: color 0.3s;">Carte</a>
            <a href="create-listing.html" style="color: #333; text-decoration: none; font-weight: 500; transition: color 0.3s;">Cr√©er une annonce</a>
        </div>
    </nav>
    <div id="map"></div>
    <script>
        // Initialiser la carte centr√©e sur la France
        const map = L.map('map').setView([46.603354, 2.888334], 6);
        
        // Ajouter la couche OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19
        }).addTo(map);
        
        // R√©cup√©rer les annonces depuis l'API Xano
        fetch('https://x8ki-letl-twmt.n7.xano.io/api:eRvwNQ3D/listing')
            .then(response => response.json())
            .then(listings => {
                console.log('Annonces r√©cup√©r√©es:', listings);
                
                // Ajouter un marqueur pour chaque annonce
                listings.forEach(listing => {
                    // Utiliser les coordonn√©es si disponibles, sinon coordonn√©es par d√©faut (Paris)
                    const lat = listing.latitude || 48.8566;
                    const lng = listing.longitude || 2.3522;
                    
                    // Cr√©er un marqueur personnalis√©
                    const marker = L.marker([lat, lng]).addTo(map);
                    
                    // Cr√©er le contenu du popup
                    const popupContent = `
                        <div class="popup-content">
                            <h3>${listing.title || 'Sans titre'}</h3>
                            <p><strong>Type:</strong> ${listing.type || 'Non sp√©cifi√©'}</p>
                            <p><strong>Description:</strong> ${(listing.description || 'Pas de description').substring(0, 100)}...</p>
                            <p class="price">üíµ Prix: ${listing.price_per_night || 'N/A'}‚Ç¨/nuit</p>
                            <p><strong>Couchages:</strong> ${listing.beds || 'N/A'} personnes</p>
                        </div>
                    `;
                    
                    // Attacher le popup au marqueur
                    marker.bindPopup(popupContent);
                });
                
                // Message si aucune annonce
                if (listings.length === 0) {
                    alert('üîç Aucune annonce trouv√©e pour le moment.\nUtilisez le formulaire de cr√©ation pour ajouter des annonces!');
                } else {
                    console.log(`‚úÖ ${listings.length} annonce(s) affich√©e(s) sur la carte`);
                }
            })
            .catch(error => {
                console.error('Erreur lors du chargement des annonces:', error);
                alert('‚ùå Erreur lors du chargement des annonces.\nLa carte s\'affiche mais sans annonces.');
            });
    </script>
</body>
</html>
